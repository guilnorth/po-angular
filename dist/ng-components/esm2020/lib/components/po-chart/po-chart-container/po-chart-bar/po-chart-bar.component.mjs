import { Component } from '@angular/core';
import { PoChartPlotAreaPaddingTop } from './../../helpers/po-chart-default-values.constant';
import { PoChartBarBaseComponent } from './po-chart-bar-base.component';
import * as i0 from "@angular/core";
import * as i1 from "./../../services/po-chart-maths.service";
import * as i2 from "@angular/common";
import * as i3 from "./po-chart-bar-path/po-chart-bar-path.component";
const _c0 = ["po-chart-bar", ""];
function PoChartBarComponent__svg_g_1_Template(rf, ctx) { if (rf & 1) {
    const _r4 = i0.ɵɵgetCurrentView();
    i0.ɵɵnamespaceSVG();
    i0.ɵɵelementStart(0, "g")(1, "g", 1);
    i0.ɵɵlistener("p-bar-click", function PoChartBarComponent__svg_g_1_Template__svg_g_p_bar_click_1_listener($event) { i0.ɵɵrestoreView(_r4); const ctx_r3 = i0.ɵɵnextContext(); return i0.ɵɵresetView(ctx_r3.onSerieBarClick($event)); })("p-bar-hover", function PoChartBarComponent__svg_g_1_Template__svg_g_p_bar_hover_1_listener($event) { i0.ɵɵrestoreView(_r4); const ctx_r5 = i0.ɵɵnextContext(); return i0.ɵɵresetView(ctx_r5.onSerieBarHover($event)); });
    i0.ɵɵelementEnd()();
} if (rf & 2) {
    const item_r1 = ctx.$implicit;
    const i_r2 = ctx.index;
    const ctx_r0 = i0.ɵɵnextContext();
    i0.ɵɵclassMap("po-chart-bar-group-" + i_r2);
    i0.ɵɵadvance(1);
    i0.ɵɵproperty("p-color", item_r1[0] == null ? null : item_r1[0].color)("p-coordinates", item_r1)("p-tooltip-position", ctx_r0.tooltipPosition);
    i0.ɵɵattribute("key", "po-chart-bar-path-" + i_r2);
} }
export class PoChartBarComponent extends PoChartBarBaseComponent {
    constructor(mathsService) {
        super(mathsService);
        this.mathsService = mathsService;
        this.tooltipPosition = 'right';
    }
    barCoordinates(seriesIndex, serieItemDataIndex, containerSize, minMaxSeriesValues, serieValue) {
        const { svgPlottingAreaWidth, barHeight, spaceBetweenBars } = this.calculateElementsMeasurements(containerSize);
        const { x1, x2 } = this.xCoordinates(minMaxSeriesValues, svgPlottingAreaWidth, containerSize.axisXLabelWidth, containerSize.svgWidth, serieValue);
        const { y1, y2 } = this.yCoordinates(seriesIndex, serieItemDataIndex, containerSize.svgPlottingAreaHeight, barHeight, spaceBetweenBars);
        return ['M', x1, y2, 'L', x2, y2, 'L', x2, y1, 'L', x1, y1, 'z'].join(' ');
    }
    calculateElementsMeasurements(containerSize) {
        const { svgWidth, svgPlottingAreaHeight, axisXLabelWidth } = containerSize;
        // Fração das séries em relação à largura da categoria. Incrementa + 2 na extensão das séries pois se trata da área de margem entre as categorias.
        const svgPlottingAreaWidth = svgWidth - axisXLabelWidth;
        const categoryHeight = svgPlottingAreaHeight / this.seriesGreaterLength;
        const columnFraction = categoryHeight / (this.series.length + 2);
        // Área entre as colunas: retorna zero se houver apenas uma série.
        const spaceBetweenBars = this.series.length > 1 ? columnFraction / (this.series.length + 2) : 0;
        // Subtrai a fração das séries pelo espaço entre as colunas.
        const barHeight = columnFraction - (spaceBetweenBars * (this.series.length - 1)) / (this.series.length + 2);
        return { svgPlottingAreaWidth, barHeight, spaceBetweenBars };
    }
    xCoordinates(minMaxSeriesValues, svgPlottingAreaWidth, axisXLabelWidth, svgWidth, serieValue) {
        const { minValue } = minMaxSeriesValues;
        const valueZeroPercentage = this.mathsService.getSeriePercentage(minMaxSeriesValues, minValue < 0 ? 0 : minValue);
        const x1 = axisXLabelWidth + (svgWidth - axisXLabelWidth) * valueZeroPercentage;
        const xRatio = this.mathsService.getSeriePercentage(minMaxSeriesValues, serieValue);
        const x2 = Math.round(svgPlottingAreaWidth * xRatio + axisXLabelWidth);
        return { x1, x2 };
    }
    yCoordinates(seriesIndex, serieItemDataIndex, svgPlottingAreaHeight, barHeight, spaceBetweenBars) {
        const spaceBetweenAxisAndBars = barHeight;
        const yRatio = serieItemDataIndex / this.seriesGreaterLength;
        const y1 = Math.round(PoChartPlotAreaPaddingTop +
            svgPlottingAreaHeight * yRatio +
            spaceBetweenAxisAndBars +
            barHeight * seriesIndex +
            spaceBetweenBars * seriesIndex);
        const y2 = Math.round(y1 + barHeight);
        return { y1, y2 };
    }
}
PoChartBarComponent.ɵfac = function PoChartBarComponent_Factory(t) { return new (t || PoChartBarComponent)(i0.ɵɵdirectiveInject(i1.PoChartMathsService)); };
PoChartBarComponent.ɵcmp = /*@__PURE__*/ i0.ɵɵdefineComponent({ type: PoChartBarComponent, selectors: [["", "po-chart-bar", ""]], features: [i0.ɵɵInheritDefinitionFeature], attrs: _c0, decls: 2, vars: 2, consts: [[3, "class", 4, "ngFor", "ngForOf", "ngForTrackBy"], ["po-chart-bar-path", "", 3, "p-color", "p-coordinates", "p-tooltip-position", "p-bar-click", "p-bar-hover"]], template: function PoChartBarComponent_Template(rf, ctx) { if (rf & 1) {
        i0.ɵɵnamespaceSVG();
        i0.ɵɵelementStart(0, "g");
        i0.ɵɵtemplate(1, PoChartBarComponent__svg_g_1_Template, 2, 6, "g", 0);
        i0.ɵɵelementEnd();
    } if (rf & 2) {
        i0.ɵɵadvance(1);
        i0.ɵɵproperty("ngForOf", ctx.seriesPathsCoordinates)("ngForTrackBy", ctx.trackBy);
    } }, dependencies: [i2.NgForOf, i3.PoChartBarPathComponent], encapsulation: 2 });
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && i0.ɵsetClassMetadata(PoChartBarComponent, [{
        type: Component,
        args: [{ selector: '[po-chart-bar]', template: "<svg:g>\r\n  <svg:g *ngFor=\"let item of seriesPathsCoordinates; let i = index; trackBy: trackBy\"\r\n    [class]=\"'po-chart-bar-group-' + i\"\r\n  >\r\n    <!-- SERIES PATHS -->\r\n    <svg:g po-chart-bar-path\r\n      [attr.key]=\"'po-chart-bar-path-' + i\"\r\n      [p-color]=\"item[0]?.color\" \r\n      [p-coordinates]=\"item\"\r\n      [p-tooltip-position]=\"tooltipPosition\"\r\n      (p-bar-click)=\"onSerieBarClick($event)\"\r\n      (p-bar-hover)=\"onSerieBarHover($event)\"\r\n      >\r\n      </svg:g>\r\n  </svg:g>\r\n</svg:g>" }]
    }], function () { return [{ type: i1.PoChartMathsService }]; }, null); })();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tY2hhcnQtYmFyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL3VpL3NyYy9saWIvY29tcG9uZW50cy9wby1jaGFydC9wby1jaGFydC1jb250YWluZXIvcG8tY2hhcnQtYmFyL3BvLWNoYXJ0LWJhci5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy91aS9zcmMvbGliL2NvbXBvbmVudHMvcG8tY2hhcnQvcG8tY2hhcnQtY29udGFpbmVyL3BvLWNoYXJ0LWJhci9wby1jaGFydC1iYXIuY29tcG9uZW50LnN2ZyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRTFDLE9BQU8sRUFBRSx5QkFBeUIsRUFBRSxNQUFNLGtEQUFrRCxDQUFDO0FBRTdGLE9BQU8sRUFBRSx1QkFBdUIsRUFBRSxNQUFNLCtCQUErQixDQUFDOzs7Ozs7Ozs7SUNIdEUseUJBRUMsV0FBQTtJQU9HLHFMQUFlLGVBQUEsOEJBQXVCLENBQUEsSUFBQyx3S0FDeEIsZUFBQSw4QkFBdUIsQ0FBQSxJQURDO0lBR3ZDLGlCQUFRLEVBQUE7Ozs7O0lBWFYsMkNBQW1DO0lBS2pDLGVBQTBCO0lBQTFCLHNFQUEwQiwwQkFBQSw4Q0FBQTtJQUQxQixrREFBcUM7O0FEUTNDLE1BQU0sT0FBTyxtQkFBb0IsU0FBUSx1QkFBdUI7SUFHOUQsWUFBc0IsWUFBaUM7UUFDckQsS0FBSyxDQUFDLFlBQVksQ0FBQyxDQUFDO1FBREEsaUJBQVksR0FBWixZQUFZLENBQXFCO1FBRjlDLG9CQUFlLEdBQUcsT0FBTyxDQUFDO0lBSW5DLENBQUM7SUFFUyxjQUFjLENBQ3RCLFdBQW1CLEVBQ25CLGtCQUEwQixFQUMxQixhQUFtQyxFQUNuQyxrQkFBdUMsRUFDdkMsVUFBa0I7UUFFbEIsTUFBTSxFQUFFLG9CQUFvQixFQUFFLFNB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Z0JBQXdCO1FBRXhCLE1BQU0sdUJBQXVCLEdBQUcsU0FBUyxDQUFDO1FBQzFDLE1BQU0sTUFBTSxHQUFHLGtCQUFrQixHQUFHLElBQUksQ0FBQyxtQkFBbUIsQ0FBQztRQUU3RCxNQUFNLEVBQUUsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUNuQix5QkFBeUI7WUFDdkIscUJBQXFCLEdBQUcsTUFBTTtZQUM5Qix1QkFBdUI7WUFDdkIsU0FBUyxHQUFHLFdBQVc7WUFDdkIsZ0JBQWdCLEdBQUcsV0FBVyxDQUNqQyxDQUFDO1FBRUYsTUFBTSxFQUFFLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxFQUFFLEdBQUcsU0FBUyxDQUFDLENBQUM7UUFDdEMsT0FBTyxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsQ0FBQztJQUNwQixDQUFDOztzRkF4RlUsbUJBQW1CO3NFQUFuQixtQkFBbUI7UUNkaEMsbUJBQU87UUFBUCx5QkFBTztRQUNMLHFFQWFRO1FBQ1YsaUJBQVE7O1FBZGtCLGVBQTJCO1FBQTNCLG9EQUEyQiw2QkFBQTs7dUZEYXhDLG1CQUFtQjtjQUovQixTQUFTOzJCQUNFLGdCQUFnQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5cclxuaW1wb3J0IHsgUG9DaGFydFBsb3RBcmVhUGFkZGluZ1RvcCB9IGZyb20gJy4vLi4vLi4vaGVscGVycy9wby1jaGFydC1kZWZhdWx0LXZhbHVlcy5jb25zdGFudCc7XHJcblxyXG5pbXBvcnQgeyBQb0NoYXJ0QmFyQmFzZUNvbXBvbmVudCB9IGZyb20gJy4vcG8tY2hhcnQtYmFyLWJhc2UuY29tcG9uZW50JztcclxuaW1wb3J0IHsgUG9DaGFydE1hdGhzU2VydmljZSB9IGZyb20gJy4vLi4vLi4vc2VydmljZXMvcG8tY2hhcnQtbWF0aHMuc2VydmljZSc7XHJcblxyXG5pbXBvcnQgeyBQb0NoYXJ0Q29udGFpbmVyU2l6ZSB9IGZyb20gJy4vLi4vLi4vaW50ZXJmYWNlcy9wby1jaGFydC1jb250YWluZXItc2l6ZS5pbnRlcmZhY2UnO1xyXG5pbXBvcnQgeyBQb0NoYXJ0TWluTWF4VmFsdWVzIH0gZnJvbSAnLi8uLi8uLi9pbnRlcmZhY2VzL3BvLWNoYXJ0LW1pbi1tYXgtdmFsdWVzLmludGVyZmFjZSc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ1twby1jaGFydC1iYXJdJyxcclxuICB0ZW1wbGF0ZVVybDogJy4vcG8tY2hhcnQtYmFyLmNvbXBvbmVudC5zdmcnXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBQb0NoYXJ0QmFyQ29tcG9uZW50IGV4dGVuZHMgUG9DaGFydEJhckJhc2VDb21wb25lbnQge1xyXG4gIHJlYWRvbmx5IHRvb2x0aXBQb3NpdGlvbiA9ICdyaWdodCc7XHJcblxyXG4gIGNvbnN0cnVjdG9yKHByb3RlY3RlZCBtYXRoc1NlcnZpY2U6IFBvQ2hhcnRNYXRoc1NlcnZpY2UpIHtcclxuICAgIHN1cGVyKG1hdGhzU2VydmljZSk7XHJcbiAgfVxyXG5cclxuICBwcm90ZWN0ZWQgYmFyQ29vcmRpbmF0ZXMoXHJcbiAgICBzZXJpZXNJbmRleDogbnVtYmVyLFxyXG4gICAgc2VyaWVJdGVtRGF0YUluZGV4OiBudW1iZXIsXHJcbiAgICBjb250YWluZXJTaXplOiBQb0NoYXJ0Q29udGFpbmVyU2l6ZSxcclxuICAgIG1pbk1heFNlcmllc1ZhbHVlczogUG9DaGFydE1pbk1heFZhbHVlcyxcclxuICAgIHNlcmllVmFsdWU6IG51bWJlclxyXG4gICkge1xyXG4gICAgY29uc3QgeyBzdmdQbG90dGluZ0FyZWFXaWR0aCwgYmFySGVpZ2h0LCBzcGFjZUJldHdlZW5CYXJzIH0gPSB0aGlzLmNhbGN1bGF0ZUVsZW1lbnRzTWVhc3VyZW1lbnRzKGNvbnRhaW5lclNpemUpO1xyXG5cclxuICAgIGNvbnN0IHsgeDEsIHgyIH0gPSB0aGlzLnhDb29yZGluYXRlcyhcclxuICAgICAgbWluTWF4U2VyaWVzVmFsdWVzLFxyXG4gICAgICBzdmdQbG90dGluZ0FyZWFXaWR0aCxcclxuICAgICAgY29udGFpbmVyU2l6ZS5heGlzWExhYmVsV2lkdGgsXHJcbiAgICAgIGNvbnRhaW5lclNpemUuc3ZnV2lkdGgsXHJcbiAgICAgIHNlcmllVmFsdWVcclxuICAgICk7XHJcbiAgICBjb25zdCB7IHkxLCB5MiB9ID0gdGhpcy55Q29vcmRpbmF0ZXMoXHJcbiAgICAgIHNlcmllc0luZGV4LFxyXG4gICAgICBzZXJpZUl0ZW1EYXRhSW5kZXgsXHJcbiAgICAgIGNvbnRhaW5lclNpemUuc3ZnUGxvdHRpbmdBcmVhSGVpZ2h0LFxyXG4gICAgICBiYXJIZWlnaHQsXHJcbiAgICAgIHNwYWNlQmV0d2VlbkJhcnNcclxuICAgICk7XHJcblxyXG4gICAgcmV0dXJuIFsnTScsIHgxLCB5MiwgJ0wnLCB4MiwgeTIsICdMJywgeDIsIHkxLCAnTCcsIHgxLCB5MSwgJ3onXS5qb2luKCcgJyk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGNhbGN1bGF0ZUVsZW1lbnRzTWVhc3VyZW1lbnRzKGNvbnRhaW5lclNpemU6IFBvQ2hhcnRDb250YWluZXJTaXplKSB7XHJcbiAgICBjb25zdCB7IHN2Z1dpZHRoLCBzdmdQbG90dGluZ0FyZWFIZWlnaHQsIGF4aXNYTGFiZWxXaWR0aCB9ID0gY29udGFpbmVyU2l6ZTtcclxuXHJcbiAgICAvLyBGcmHDp8OjbyBkYXMgc8OpcmllcyBlbSByZWxhw6fDo28gw6AgbGFyZ3VyYSBkYSBjYXRlZ29yaWEuIEluY3JlbWVudGEgKyAyIG5hIGV4dGVuc8OjbyBkYXMgc8OpcmllcyBwb2lzIHNlIHRyYXRhIGRhIMOhcmVhIGRlIG1hcmdlbSBlbnRyZSBhcyBjYXRlZ29yaWFzLlxyXG4gICAgY29uc3Qgc3ZnUGxvdHRpbmdBcmVhV2lkdGggPSBzdmdXaWR0aCAtIGF4aXNYTGFiZWxXaWR0aDtcclxuICAgIGNvbnN0IGNhdGVnb3J5SGVpZ2h0ID0gc3ZnUGxvdHRpbmdBcmVhSGVpZ2h0IC8gdGhpcy5zZXJpZXNHcmVhdGVyTGVuZ3RoO1xyXG4gICAgY29uc3QgY29sdW1uRnJhY3Rpb24gPSBjYXRlZ29yeUhlaWdodCAvICh0aGlzLnNlcmllcy5sZW5ndGggKyAyKTtcclxuXHJcbiAgICAvLyDDgXJlYSBlbnRyZSBhcyBjb2x1bmFzOiByZXRvcm5hIHplcm8gc2UgaG91dmVyIGFwZW5hcyB1bWEgc8OpcmllLlxyXG4gICAgY29uc3Qgc3BhY2VCZXR3ZWVuQmFycyA9IHRoaXMuc2VyaWVzLmxlbmd0aCA+IDEgPyBjb2x1bW5GcmFjdGlvbiAvICh0aGlzLnNlcmllcy5sZW5ndGggKyAyKSA6IDA7XHJcblxyXG4gICAgLy8gU3VidHJhaSBhIGZyYcOnw6NvIGRhcyBzw6lyaWVzIHBlbG8gZXNwYcOnbyBlbnRyZSBhcyBjb2x1bmFzLlxyXG4gICAgY29uc3QgYmFySGVpZ2h0ID0gY29sdW1uRnJhY3Rpb24gLSAoc3BhY2VCZXR3ZWVuQmFycyAqICh0aGlzLnNlcmllcy5sZW5ndGggLSAxKSkgLyAodGhpcy5zZXJpZXMubGVuZ3RoICsgMik7XHJcblxyXG4gICAgcmV0dXJuIHsgc3ZnUGxvdHRpbmdBcmVhV2lkdGgsIGJhckhlaWdodCwgc3BhY2VCZXR3ZWVuQmFycyB9O1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSB4Q29vcmRpbmF0ZXMoXHJcbiAgICBtaW5NYXhTZXJpZXNWYWx1ZXM6IFBvQ2hhcnRNaW5NYXhWYWx1ZXMsXHJcbiAgICBzdmdQbG90dGluZ0FyZWFXaWR0aDogbnVtYmVyLFxyXG4gICAgYXhpc1hMYWJlbFdpZHRoOiBQb0NoYXJ0Q29udGFpbmVyU2l6ZVsnYXhpc1hMYWJlbFdpZHRoJ10sXHJcbiAgICBzdmdXaWR0aDogUG9DaGFydENvbnRhaW5lclNpemVbJ3N2Z1dpZHRoJ10sXHJcbiAgICBzZXJpZVZhbHVlOiBudW1iZXJcclxuICApIHtcclxuICAgIGNvbnN0IHsgbWluVmFsdWUgfSA9IG1pbk1heFNlcmllc1ZhbHVlcztcclxuICAgIGNvbnN0IHZhbHVlWmVyb1BlcmNlbnRhZ2UgPSB0aGlzLm1hdGhzU2VydmljZS5nZXRTZXJpZVBlcmNlbnRhZ2UobWluTWF4U2VyaWVzVmFsdWVzLCBtaW5WYWx1ZSA8IDAgPyAwIDogbWluVmFsdWUpO1xyXG4gICAgY29uc3QgeDEgPSBheGlzWExhYmVsV2lkdGggKyAoc3ZnV2lkdGggLSBheGlzWExhYmVsV2lkdGgpICogdmFsdWVaZXJvUGVyY2VudGFnZTtcclxuXHJcbiAgICBjb25zdCB4UmF0aW8gPSB0aGlzLm1hdGhzU2VydmljZS5nZXRTZXJpZVBlcmNlbnRhZ2UobWluTWF4U2VyaWVzVmFsdWVzLCBzZXJpZVZhbHVlKTtcclxuICAgIGNvbnN0IHgyID0gTWF0aC5yb3VuZChzdmdQbG90dGluZ0FyZWFXaWR0aCAqIHhSYXRpbyArIGF4aXNYTGFiZWxXaWR0aCk7XHJcblxyXG4gICAgcmV0dXJuIHsgeDEsIHgyIH07XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHlDb29yZGluYXRlcyhcclxuICAgIHNlcmllc0luZGV4OiBudW1iZXIsXHJcbiAgICBzZXJpZUl0ZW1EYXRhSW5kZXg6IG51bWJlcixcclxuICAgIHN2Z1Bsb3R0aW5nQXJlYUhlaWdodDogbnVtYmVyLFxyXG4gICAgYmFySGVpZ2h0OiBudW1iZXIsXHJcbiAgICBzcGFjZUJldHdlZW5CYXJzOiBudW1iZXJcclxuICApIHtcclxuICAgIGNvbnN0IHNwYWNlQmV0d2VlbkF4aXNBbmRCYXJzID0gYmFySGVpZ2h0O1xyXG4gICAgY29uc3QgeVJhdGlvID0gc2VyaWVJdGVtRGF0YUluZGV4IC8gdGhpcy5zZXJpZXNHcmVhdGVyTGVuZ3RoO1xyXG5cclxuICAgIGNvbnN0IHkxID0gTWF0aC5yb3VuZChcclxuICAgICAgUG9DaGFydFBsb3RBcmVhUGFkZGluZ1RvcCArXHJcbiAgICAgICAgc3ZnUGxvdHRpbmdBcmVhSGVpZ2h0ICogeVJhdGlvICtcclxuICAgICAgICBzcGFjZUJldHdlZW5BeGlzQW5kQmFycyArXHJcbiAgICAgICAgYmFySGVpZ2h0ICogc2VyaWVzSW5kZXggK1xyXG4gICAgICAgIHNwYWNlQmV0d2VlbkJhcnMgKiBzZXJpZXNJbmRleFxyXG4gICAgKTtcclxuXHJcbiAgICBjb25zdCB5MiA9IE1hdGgucm91bmQoeTEgKyBiYXJIZWlnaHQpO1xyXG4gICAgcmV0dXJuIHsgeTEsIHkyIH07XHJcbiAgfVxyXG59XHJcbiIsIjxzdmc6Zz5cclxuICA8c3ZnOmcgKm5nRm9yPVwibGV0IGl0ZW0gb2Ygc2VyaWVzUGF0aHNDb29yZGluYXRlczsgbGV0IGkgPSBpbmRleDsgdHJhY2tCeTogdHJhY2tCeVwiXHJcbiAgICBbY2xhc3NdPVwiJ3BvLWNoYXJ0LWJhci1ncm91cC0nICsgaVwiXHJcbiAgPlxyXG4gICAgPCEtLSBTRVJJRVMgUEFUSFMgLS0+XHJcbiAgICA8c3ZnOmcgcG8tY2hhcnQtYmFyLXBhdGhcclxuICAgICAgW2F0dHIua2V5XT1cIidwby1jaGFydC1iYXItcGF0aC0nICsgaVwiXHJcbiAgICAgIFtwLWNvbG9yXT1cIml0ZW1bMF0/LmNvbG9yXCIgXHJcbiAgICAgIFtwLWNvb3JkaW5hdGVzXT1cIml0ZW1cIlxyXG4gICAgICBbcC10b29sdGlwLXBvc2l0aW9uXT1cInRvb2x0aXBQb3NpdGlvblwiXHJcbiAgICAgIChwLWJhci1jbGljayk9XCJvblNlcmllQmFyQ2xpY2soJGV2ZW50KVwiXHJcbiAgICAgIChwLWJhci1ob3Zlcik9XCJvblNlcmllQmFySG92ZXIoJGV2ZW50KVwiXHJcbiAgICAgID5cclxuICAgICAgPC9zdmc6Zz5cclxuICA8L3N2ZzpnPlxyXG48L3N2ZzpnPiJdfQ==